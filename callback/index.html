<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Tesla Auth Callback</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="font-family: sans-serif; text-align: center; padding-top: 50px;">
    <h1 id="status">認証処理中...</h1>
    <p>MyTeslaWearAppに戻ってください。</p>
    
    <a id="app-link" href="#" 
       style="display: inline-block; padding: 15px 30px; background-color: #e31937; color: white; text-decoration: none; border-radius: 5px; font-weight: bold; margin-top: 20px;">
        アプリを開く
    </a>

    <script>
        // URLパラメータを取得
        const search = window.location.search;
        const urlParams = new URLSearchParams(search);
        const code = urlParams.get('code');
        const state = urlParams.get('state');
        const error = urlParams.get('error');

        // アプリへのIntent URLを構築
        // カスタムスキームを最優先で使用
        let intentUrl = "myteslawearapp://callback" + search;
        
        if (code) {
            document.getElementById('status').innerText = "認証完了";
        } else if (error) {
            document.getElementById('status').innerText = "認証エラー";
        }

        document.getElementById('app-link').href = intentUrl;

        // 複数の方法でリダイレクトを試みる
        function redirect() {
            // 1. カスタムスキーム (もっとも確実)
            window.location.href = intentUrl;
            
            // 2. HTTPS Intent (フォールバック)
            setTimeout(() => {
                let httpsIntent = "intent://rintaro-ko.github.io/github.io/callback" + search + "#Intent;scheme=https;package=com.example.myteslawearapp;end";
                window.location.href = httpsIntent;
            }, 1500);
        }

        // 自動的に実行
        setTimeout(redirect, 500);
    </script>
</body>
</html>
